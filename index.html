<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ—¥åœ“åŒ¯ç‡åˆ©æ½¤è¨ˆç®—å™¨</title>
  
  <style>
  
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    h1 {
      text-align: center;
      font-size: 24px;
    }
    label, input {
      display: block;
      width: 100%;
      margin: 10px 0;
      font-size: 16px;
    }
    button {
      padding: 10px;
      font-size: 16px;
      width: 100%;
      margin-top: 10px;
    }
    .result {
      margin-top: 20px;
      font-size: 18px;
    }
    .section {
      margin-top: 20px;
    }
    .section h2 {
      background: #e2e2e2;
      padding: 10px;
      cursor: pointer;
      font-size: 18px;
    }
    .section-content {
      display: none;
      padding: 10px 0;
    }

  .section.active .section-content { display: block; }

  </style>
</head>

  <div style="max-width: 1200px; margin: auto;">
  

  <p style="text-align:center; font-size:14px;">
    ğŸ”— <a href="https://rate.bot.com.tw/xrt?Lang=zh-TW" target="_blank">å°ç£éŠ€è¡ŒåŒ¯ç‡</a> ï½œ
    <a href="https://www.esunbank.com/zh-tw/personal/deposit/rate/forex/foreign-exchange-rates" target="_blank">ç‰å±±éŠ€è¡ŒåŒ¯ç‡</a>
  </p>

  <div class="section" id="section1">
    <h2 onclick="toggleSection('section1')">å•†å“ä»£è³¼</h2>
    <div class="section-content">
      <label for="jpyAmount">å•†å“åƒ¹æ ¼ï¼ˆæ—¥å¹£ï¼‰ï¼š</label>
      <input type="text" id="jpyAmount" placeholder="ä¾‹å¦‚ï¼š10000">

      <label for="rateSell">å¯¦éš›åŒ¯ç‡ï¼ˆè‡ªå‹•å–å¾—ï¼‰ï¼š</label>
      <input type="text" id="rateSell" placeholder="å–å¾—ä¸­..." readonly>

      <label for="rateAdjust">åŒ¯ç‡å¾®èª¿ï¼ˆÂ±0.0001ï½Â±0.01ï¼‰ï¼š</label>
      <input type="number" step="0.0001" id="rateAdjust" placeholder="ä¾‹å¦‚ï¼š-0.002" oninput="updateAdjustedRate()">

      <label for="adjustedRate">èª¿æ•´å¾ŒåŒ¯ç‡ï¼ˆè‡ªå‹•å¥—ç”¨ï¼‰ï¼š</label>
      <input type="text" id="adjustedRate" readonly>

      <label for="rateCharge">æ”¶å–æ—¥å¹£åŒ¯ç‡ï¼š</label>
      <input type="text" id="rateCharge" placeholder="ä¾‹å¦‚ï¼š0.27">

      <button onclick="calculateProfit()">è¨ˆç®—åˆ©æ½¤</button>
    </div>
  </div>

  <div class="section" id="section2">
    <h2 onclick="toggleSection('section2')">è³£å‡ºå°å¹£</h2>
    <div class="section-content">
      <label for="bankBuy">éŠ€è¡Œè²·å…¥åŒ¯ç‡ï¼š</label>
      <input type="text" id="bankBuy" placeholder="ä¾‹å¦‚ï¼š0.2052" oninput="updateTwdSellRate()">

      <label for="bankSell">éŠ€è¡Œè³£å‡ºåŒ¯ç‡ï¼š</label>
      <input type="text" id="bankSell" placeholder="ä¾‹å¦‚ï¼š0.2102" oninput="updateTwdSellRate()">

      <label for="sellAdjust">åŒ¯ç‡å¾®èª¿ï¼ˆÂ±ï¼‰ï¼š</label>
      <input type="number" step="0.0001" id="sellAdjust" placeholder="ä¾‹å¦‚ï¼š0.001" oninput="updateTwdSellRate()">

      <label for="twdToSell">è³£å‡ºå°å¹£æ™‚å ±åƒ¹åŒ¯ç‡ï¼š</label>
      <input type="text" id="twdToSell" readonly>

      <label for="twdAmount">è³£å‡ºå°å¹£é‡‘é¡ï¼ˆTWDï¼‰ï¼š</label>
      <input type="text" id="twdAmount" placeholder="ä¾‹å¦‚ï¼š10000">

      <label for="note">ğŸ“Œ å‚™è¨»ï¼šå¯æ‰‹å‹•è¼¸å…¥éŠ€è¡Œè²·å…¥èˆ‡è³£å‡ºåƒ¹ï¼Œä¸¦é€²è¡Œå¾®èª¿</label>

      <button onclick="calculateSellJPY()">è¨ˆç®—è³£å‡ºå°å¹£ç²å¾—å¤šå°‘æ—¥åœ“</button>
    </div>
  </div>

  <div class="result" id="result"></div>

  <script>
    let rate = 0;

    async function fetchExchangeRateHost() {
      try {
        const response = await fetch('https://open.er-api.com/v6/latest/JPY');
        if (!response.ok) throw new Error('API éŒ¯èª¤');
        const data = await response.json();
        if (!data || !data.rates || !data.rates.TWD) throw new Error('è³‡æ–™æ ¼å¼éŒ¯èª¤');
        rate = data.rates.TWD;
        document.getElementById("rateSell").value = rate.toFixed(4);
        updateAdjustedRate();
      } catch (e) {
        console.error('å–å¾—åŒ¯ç‡å¤±æ•—:', e);
        document.getElementById("rateSell").value = "å–å¾—åŒ¯ç‡å¤±æ•—";
        rate = NaN;
      }
    }

    function updateAdjustedRate() {
      const baseRate = parseFloat(document.getElementById("rateSell").value);
      const adjust = parseFloat(document.getElementById("rateAdjust").value) || 0;
      if (!isNaN(baseRate)) {
        const adjusted = baseRate + adjust;
        document.getElementById("adjustedRate").value = adjusted.toFixed(4);
      }
    }

    function updateTwdSellRate() {
      const buy = parseFloat(document.getElementById("bankBuy").value);
      const sell = parseFloat(document.getElementById("bankSell").value);
      const adjust = parseFloat(document.getElementById("sellAdjust").value) || 0;
      if (!isNaN(buy) && !isNaN(sell)) {
        const avg = (buy + sell) / 2 + adjust;
        document.getElementById("twdToSell").value = avg.toFixed(4);
      }
    }

    function formatTWD(amount) {
      return Math.round(amount) + ' TWD';
    }

    function calculateProfit() {
      const jpy = parseFloat(document.getElementById("jpyAmount").value);
      const costRate = parseFloat(document.getElementById("adjustedRate").value);
      const chargeRate = parseFloat(document.getElementById("rateCharge").value);

      if (isNaN(jpy) || isNaN(chargeRate) || isNaN(costRate)) {
        document.getElementById("result").innerText = "è«‹æ­£ç¢ºè¼¸å…¥æ‰€æœ‰æ¬„ä½ã€‚";
        return;
      }

      const cost = jpy * costRate;
      const charge = jpy * chargeRate;
      const profit = charge - cost;
      const margin = cost > 0 ? (profit / cost * 100) : 0;

      document.getElementById("result").innerHTML = `
        <strong>å¯¦éš›åŒ¯ç‡ï¼ˆå«å¾®èª¿ï¼‰ï¼š</strong> ${costRate.toFixed(4)}<br>
        <strong>æˆæœ¬ï¼š</strong> ${formatTWD(cost)}<br>
        <strong>æ”¶å…¥ï¼š</strong> ${formatTWD(charge)}<br>
        <strong>åˆ©æ½¤ï¼š</strong> ${formatTWD(profit)}<br>
        <strong>åˆ©æ½¤ç‡ï¼š</strong> ${margin.toFixed(2)}%<br>
        <small style="color:gray;">è³‡æ–™ä¾†æºï¼šopen.er-api.com</small>
      `;
    }

    function calculateSellJPY() {
      const costRate = 0.27;
      const jpyPerTwdCost = 1 / costRate;

      const sellRate = parseFloat(document.getElementById("twdToSell").value);
      const twdAmount = parseFloat(document.getElementById("twdAmount").value);

      if (isNaN(sellRate) || isNaN(twdAmount)) {
        document.getElementById("result").innerText = "è«‹è¼¸å…¥å°å¹£é‡‘é¡èˆ‡å ±åƒ¹åŒ¯ç‡ã€‚";
        return;
      }

      const jpyReceived = twdAmount / sellRate;
      const costJPY = twdAmount * jpyPerTwdCost;
      const profitJPY = jpyReceived - costJPY;

      document.getElementById("result").innerHTML = `
        <strong>ä½ æ”¶åˆ°ï¼š</strong> ${jpyReceived.toFixed(0)} JPY<br>
        <strong>æˆæœ¬ï¼š</strong> ${costJPY.toFixed(0)} JPY<br>
        <strong>åˆ©æ½¤ï¼š</strong> ${profitJPY.toFixed(0)} JPY<br>
        <strong>æ¯å°å¹£æˆæœ¬ï¼š</strong> ${jpyPerTwdCost.toFixed(4)} JPY<br>
        <strong>ä½ å ±åƒ¹çš„æ¯å°å¹£æ›å›ï¼š</strong> ${(1 / sellRate).toFixed(4)} JPY
      `;
    }

    function toggleSection(id) {
      const section = document.getElementById(id);
      section.classList.toggle("active");
    }

    fetchExchangeRateHost();
  </script>
  </div>

</html>
